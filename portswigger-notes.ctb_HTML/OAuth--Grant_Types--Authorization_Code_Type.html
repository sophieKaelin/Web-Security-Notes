<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Authorization Code Type</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Authorization Code Type</h1><br/><span style="text-decoration:underline;">Authorization code grant type</span><br />• use redirects to exchange series of browser-based HTTP requests that initiate the flow.<br /><a href="https://portswigger.net/web-security/images/oauth-authorization-code-flow.jpg"><img src="images/97-1.png" alt="images/97-1.png" /></a><br /><br /><span style="text-decoration:underline;">1. Authorization Request</span><br />• /authorization endpoint (doesn&#39;t have to be called “authorization” could be “auth”)<br />• Parameters:<br />   ◇ client_id: unique identifer of client app (generated at registration)<br />   ◇ redirect_uri: where a user should be redirect to when sending auth code to client app. (Attacks based off exploiting this flaw)<br />   ◇ response_type: what respponse client is expecting (what flow it wants to initiate). <code>code</code><br />   ◇ scope: which subset of user&#39;s data to access. (maybe custom scopes or ones standard to OAuth)<br />   ◇ state: unique, unguessable value tied to current session of client app. OAuth should return exact value back in response along with auth code. (sort of like a CSRF token)<br /><br /><span style="text-decoration:underline;">2. User Login and Consent</span><br />• User Redirected to login page <br />• Once user has approved once, this step will be completed automatically.<br /><br /><span style="text-decoration:underline;">3. Authorization code grant</span><br />• User redirected to url specified in redirect_uri parameter.<br />• Get request will contain authorization code as a query parameter <br />   ◇ maybe also the state parameter.<br /><br /><span style="text-decoration:underline;">4. Access Token Request</span><br />• Auhtorization code needs to be exchanged for an access token<br />• server-to-server POST request to OAuth&#39;s /token endpoint.<br />• All communication from here takes place in secure back-channel (cannot usually be observed / controlled by an attacker)<br />• Request Parameters:<br />   ◇ client_id<br />   ◇ redirect_uri<br />   ◇ code = auth code?<br />   ◇ client_secret = client app authentication (secret key assigned during registration)<br />   ◇ grant_type = ensures new endpoints know what type the client wants to use (this case, authorization_code)<br /><br /><span style="text-decoration:underline;">5. Acess token grant</span><br /><code>{<br />  &quot;access_token&quot;: &quot;z0y9x8w7v6u5&quot;,<br />  &quot;token_type&quot;: &quot;Bearer&quot;,<br />  &quot;expires_in&quot;: 3600,<br />  &quot;scope&quot;: &quot;openid profile&quot;,<br />  …<br />}</code><br /><br /><span style="text-decoration:underline;">6. API Call</span><br />• fetch user data from resource server<br />• API call to /userinfo<br />• Access token in Authorization: Bearer header.<br /><br /><span style="text-decoration:underline;">7. Resource Grant</span><br />• Token verified (if correct)<br /><br /><span style="text-decoration:underline;">8. User is logged in </span></div></body></html>