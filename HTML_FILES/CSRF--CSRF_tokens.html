<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>CSRF tokens</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>CSRF tokens</h1><br/><strong>What are they?</strong><br />• unique, secret, unpredictable value generated server-side and transmitted to client<br />• included in subsequent HTTP requests<br />   ◇ Request made, server validates request contains valid token before executing request<br />• Must have high entropy, tied to users session and validated in every case before action executed.<br />• Since attacker can&#39;t determine/predict value of token, can&#39;t construct naughty request with all parameters.<br /><strong><br />How should the tokens be generated</strong><br />• Should have significant entropy and strongly unpredictable<br />• Use cryptographic strength pseudo-random number generator (PRNG)<br />• Seeded with timestamp + static secret<br />• Can create smaller tokens, merge then hash if you want to be SUPER SAFE<br /><strong><br />How are the tokens transmitted?</strong><br />• Just don&#39;t tell people dummy<br />• Transmit as hidden field of HTML form submitted using POST method<br />   ◇ Safe-ish<br />• placed at top of HTML, before non-hidden input<br />• Shouldn&#39;t be put in URL query string<br />   ◇ this is logged and can be transmitted to third parties<br />• Custom request header<br />   ◇ Good because most browsers don&#39;t allow custom headers to be sent cross-domain<br />   ◇ limitations: only make CSRF protected requests using XHR (over-complicated)<br />• SHOULD NOT BE TRANSMITTED WITHIN COOKIES<br /><strong><br />How should the tokens be validated?</strong><br />• Should be stored server-side in user&#39;s session data<br />• When request is recieved, server should verify request includes token matching value stored in users session data<br />• Request rejected if token is invalid or not present.</div></body></html>